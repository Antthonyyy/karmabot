# –ó–∞–¥–∞—á–∞: –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö `/shared/schema.ts`:

```typescript
// –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É users
export const users = sqliteTable('users', {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
  
  // –†–µ–∂–∏–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
  reminderMode: text('reminder_mode').default('balanced'), // 'intensive', 'balanced', 'light', 'custom'
  dailyPrinciplesCount: integer('daily_principles_count').default(2), // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –≤ –¥–µ–Ω—å
  
  // –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è morningReminderTime –∏ eveningReminderTime
});

// –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
export const reminderSchedules = sqliteTable('reminder_schedules', {
  id: integer('id').primaryKey({ autoIncrement: true }),
  userId: integer('user_id').notNull().references(() => users.id),
  time: text('time').notNull(), // –í—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ HH:MM
  type: text('type').notNull(), // 'principle' –∏–ª–∏ 'reflection'
  enabled: integer('enabled', { mode: 'boolean' }).default(true),
  createdAt: timestamp('created_at').defaultNow(),
});

// –û–±–Ω–æ–≤–∏—Ç—å userPrinciples –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –≤ –¥–µ–Ω—å
export const userPrinciples = sqliteTable('user_principles', {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
  principleOrder: integer('principle_order').default(1), // –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –ø—Ä–∏–Ω—Ü–∏–ø–∞ –∑–∞ –¥–µ–Ω—å
  reminderTime: text('reminder_time'), // –í—Ä–µ–º—è, –∫–æ–≥–¥–∞ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø—Ä–∏–Ω—Ü–∏–ø
});
```

### 2. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π `/src/components/ReminderModeSelector.tsx`:

```typescript
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Clock, Zap, Battery, Feather, Settings } from "lucide-react";

interface ReminderMode {
  id: string;
  name: string;
  description: string;
  principlesPerDay: number;
  schedule: { time: string; type: 'principle' | 'reflection' }[];
  icon: React.ReactNode;
  color: string;
}

const reminderModes: ReminderMode[] = [
  {
    id: 'intensive',
    name: '–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∏–π',
    description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ –∑ 4 –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ —â–æ–¥–Ω—è',
    principlesPerDay: 4,
    schedule: [
      { time: '07:00', type: 'principle' },
      { time: '11:00', type: 'principle' },
      { time: '15:00', type: 'principle' },
      { time: '19:00', type: 'principle' },
      { time: '21:00', type: 'reflection' },
    ],
    icon: <Zap className="h-5 w-5" />,
    color: 'bg-red-100 text-red-700 border-red-200',
  },
  {
    id: 'balanced',
    name: '–ó–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∏–π',
    description: '2-3 –ø—Ä–∏–Ω—Ü–∏–ø–∏ —â–æ–¥–Ω—è –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—É',
    principlesPerDay: 3,
    schedule: [
      { time: '08:00', type: 'principle' },
      { time: '13:00', type: 'principle' },
      { time: '18:00', type: 'principle' },
      { time: '21:00', type: 'reflection' },
    ],
    icon: <Battery className="h-5 w-5" />,
    color: 'bg-green-100 text-green-700 border-green-200',
  },
  {
    id: 'light',
    name: '–õ–µ–≥–∫–∏–π',
    description: '2 –ø—Ä–∏–Ω—Ü–∏–ø–∏ —â–æ–¥–Ω—è –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤',
    principlesPerDay: 2,
    schedule: [
      { time: '09:00', type: 'principle' },
      { time: '15:00', type: 'principle' },
      { time: '20:00', type: 'reflection' },
    ],
    icon: <Feather className="h-5 w-5" />,
    color: 'bg-blue-100 text-blue-700 border-blue-200',
  },
  {
    id: 'custom',
    name: '–í–ª–∞—Å–Ω–∏–π',
    description: '–ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Ä–æ–∑–∫–ª–∞–¥ –ø—ñ–¥ —Å–µ–±–µ',
    principlesPerDay: 0,
    schedule: [],
    icon: <Settings className="h-5 w-5" />,
    color: 'bg-purple-100 text-purple-700 border-purple-200',
  },
];

interface ReminderModeSelectorProps {
  selectedMode: string;
  onModeSelect: (mode: string) => void;
}

export default function ReminderModeSelector({ selectedMode, onModeSelect }: ReminderModeSelectorProps) {
  return (
    <div className="grid gap-4 md:grid-cols-2">
      {reminderModes.map((mode) => (
        <Card
          key={mode.id}
          className={`cursor-pointer transition-all hover:shadow-lg ${
            selectedMode === mode.id ? 'ring-2 ring-purple-600' : ''
          }`}
          onClick={() => onModeSelect(mode.id)}
        >
          <CardContent className="p-6">
            <div className="flex items-start justify-between mb-3">
              <div className={`p-2 rounded-lg ${mode.color}`}>
                {mode.icon}
              </div>
              {selectedMode === mode.id && (
                <Badge variant="secondary">–û–±—Ä–∞–Ω–æ</Badge>
              )}
            </div>
            
            <h3 className="font-semibold text-lg mb-2">{mode.name}</h3>
            <p className="text-sm text-gray-600 mb-4">{mode.description}</p>
            
            {mode.id !== 'custom' && (
              <div className="space-y-2">
                <div className="flex items-center gap-2 text-sm">
                  <Clock className="h-4 w-4 text-gray-400" />
                  <span className="font-medium">{mode.principlesPerDay} –ø—Ä–∏–Ω—Ü–∏–ø–∏ —â–æ–¥–Ω—è</span>
                </div>
                <div className="text-xs text-gray-500">
                  –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: {mode.schedule.map(s => s.time).join(', ')}
                </div>
              </div>
            )}
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
```

### 3. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è `/src/components/CustomScheduleEditor.tsx`:

```typescript
import { useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Switch } from "@/components/ui/switch";
import { Plus, Trash2, Clock } from "lucide-react";

interface ScheduleItem {
  time: string;
  type: 'principle' | 'reflection';
  enabled: boolean;
}

interface CustomScheduleEditorProps {
  schedule: ScheduleItem[];
  onChange: (schedule: ScheduleItem[]) => void;
  principlesCount: number;
  onPrinciplesCountChange: (count: number) => void;
}

export default function CustomScheduleEditor({ 
  schedule, 
  onChange, 
  principlesCount,
  onPrinciplesCountChange 
}: CustomScheduleEditorProps) {
  const addScheduleItem = () => {
    const newItem: ScheduleItem = {
      time: '12:00',
      type: 'principle',
      enabled: true,
    };
    onChange([...schedule, newItem]);
  };
  
  const removeScheduleItem = (index: number) => {
    onChange(schedule.filter((_, i) => i !== index));
  };
  
  const updateScheduleItem = (index: number, updates: Partial<ScheduleItem>) => {
    const newSchedule = [...schedule];
    newSchedule[index] = { ...newSchedule[index], ...updates };
    onChange(newSchedule);
  };
  
  const principleReminders = schedule.filter(s => s.type === 'principle').length;
  
  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤–ª–∞—Å–Ω–æ–≥–æ —Ä–æ–∑–∫–ª–∞–¥—É</CardTitle>
      </CardHeader>
      <CardContent className="space-y-6">
        {/* –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ */}
        <div className="space-y-2">
          <Label>–°–∫—ñ–ª—å–∫–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ –Ω–∞ –¥–µ–Ω—å –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫—É–≤–∞—Ç–∏?</Label>
          <Select
            value={principlesCount.toString()}
            onValueChange={(value) => onPrinciplesCountChange(parseInt(value))}
          >
            <SelectTrigger>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="2">2 –ø—Ä–∏–Ω—Ü–∏–ø–∏ (–º—ñ–Ω—ñ–º—É–º)</SelectItem>
              <SelectItem value="3">3 –ø—Ä–∏–Ω—Ü–∏–ø–∏</SelectItem>
              <SelectItem value="4">4 –ø—Ä–∏–Ω—Ü–∏–ø–∏</SelectItem>
              <SelectItem value="5">5 –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤</SelectItem>
              <SelectItem value="6">6 –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ (–º–∞–∫—Å–∏–º—É–º)</SelectItem>
            </SelectContent>
          </Select>
        </div>
        
        {/* –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å */}
        {principleReminders < principlesCount && (
          <div className="bg-yellow-50 p-3 rounded-lg text-sm text-yellow-800">
            ‚ö†Ô∏è –î–æ–¥–∞–π—Ç–µ —â–µ {principlesCount - principleReminders} –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤
          </div>
        )}
        
        {/* –°–ø–∏—Å–æ–∫ –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å */}
        <div className="space-y-3">
          <div className="flex items-center justify-between">
            <Label>–†–æ–∑–∫–ª–∞–¥ –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å</Label>
            <Button
              size="sm"
              variant="outline"
              onClick={addScheduleItem}
              className="h-8"
            >
              <Plus className="h-4 w-4 mr-1" />
              –î–æ–¥–∞—Ç–∏
            </Button>
          </div>
          
          {schedule.length === 0 && (
            <div className="text-center py-8 text-gray-500">
              –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–î–æ–¥–∞—Ç–∏" —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è
            </div>
          )}
          
          {schedule.map((item, index) => (
            <div key={index} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
              <Clock className="h-4 w-4 text-gray-400" />
              
              <Input
                type="time"
                value={item.time}
                onChange={(e) => updateScheduleItem(index, { time: e.target.value })}
                className="w-32"
              />
              
              <Select
                value={item.type}
                onValueChange={(value: 'principle' | 'reflection') => 
                  updateScheduleItem(index, { type: value })
                }
              >
                <SelectTrigger className="w-40">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="principle">–ù–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø</SelectItem>
                  <SelectItem value="reflection">–†–µ—Ñ–ª–µ–∫—Å—ñ—è</SelectItem>
                </SelectContent>
              </Select>
              
              <Switch
                checked={item.enabled}
                onCheckedChange={(enabled) => updateScheduleItem(index, { enabled })}
              />
              
              <Button
                size="sm"
                variant="ghost"
                onClick={() => removeScheduleItem(index)}
                className="h-8 w-8 p-0 text-red-600"
              >
                <Trash2 className="h-4 w-4" />
              </Button>
            </div>
          ))}
        </div>
        
        {/* –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó */}
        <div className="bg-blue-50 p-4 rounded-lg">
          <h4 className="font-medium text-sm text-blue-900 mb-2">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</h4>
          <ul className="text-sm text-blue-700 space-y-1">
            <li>‚Ä¢ –†–æ–∑–ø–æ–¥—ñ–ª—ñ—Ç—å –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è —Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–æ –ø—Ä–æ—Ç—è–≥–æ–º –¥–Ω—è</li>
            <li>‚Ä¢ –î–æ–¥–∞–π—Ç–µ —Ä–µ—Ñ–ª–µ–∫—Å—ñ—é –≤–≤–µ—á–µ—Ä—ñ –¥–ª—è –ø—ñ–¥–≤–µ–¥–µ–Ω–Ω—è –ø—ñ–¥—Å—É–º–∫—ñ–≤</li>
            <li>‚Ä¢ –ü–æ—á–∏–Ω–∞–π—Ç–µ –∑ 2-3 –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ —ñ –∑–±—ñ–ª—å—à—É–π—Ç–µ –ø–æ—Å—Ç—É–ø–æ–≤–æ</li>
          </ul>
        </div>
      </CardContent>
    </Card>
  );
}
```

### 4. –û–±–Ω–æ–≤–∏—Ç—å OnboardingPage –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã
import ReminderModeSelector from "@/components/ReminderModeSelector";
import CustomScheduleEditor from "@/components/CustomScheduleEditor";

// –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
const [reminderMode, setReminderMode] = useState('balanced');
const [customSchedule, setCustomSchedule] = useState<ScheduleItem[]>([]);
const [principlesCount, setPrinciplesCount] = useState(2);

// –û–±–Ω–æ–≤–∏—Ç—å handleComplete
const handleComplete = async () => {
  setIsSaving(true);
  try {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∂–∏–º –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
    await apiRequest("POST", "/api/user/setup-reminders", {
      mode: reminderMode,
      principlesCount,
      customSchedule: reminderMode === 'custom' ? customSchedule : undefined,
    });
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  } catch (error) {
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  }
};

// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —à–∞–≥–∏ –≤ onboarding:
// –®–∞–≥ 2: –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
{step === 2 && (
  <div className="space-y-6">
    <div className="text-center mb-6">
      <h3 className="text-lg font-semibold mb-2">–û–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∏</h3>
      <p className="text-sm text-gray-600">
        –°–∫—ñ–ª—å–∫–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—Ä–∞–∫—Ç–∏–∫—É–≤–∞—Ç–∏ —â–æ–¥–Ω—è?
      </p>
    </div>
    
    <ReminderModeSelector
      selectedMode={reminderMode}
      onModeSelect={setReminderMode}
    />
    
    <div className="flex gap-3">
      <Button variant="outline" onClick={() => setStep(1)} className="flex-1">
        –ù–∞–∑–∞–¥
      </Button>
      <Button 
        onClick={() => {
          if (reminderMode === 'custom') {
            setStep(3); // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
          } else {
            setStep(4); // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é
          }
        }} 
        className="flex-1"
      >
        –î–∞–ª—ñ
        <ChevronRight className="ml-2 h-4 w-4" />
      </Button>
    </div>
  </div>
)}

// –®–∞–≥ 3: –ö–∞—Å—Ç–æ–º–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è custom —Ä–µ–∂–∏–º–∞)
{step === 3 && reminderMode === 'custom' && (
  <div className="space-y-6">
    <CustomScheduleEditor
      schedule={customSchedule}
      onChange={setCustomSchedule}
      principlesCount={principlesCount}
      onPrinciplesCountChange={setPrinciplesCount}
    />
    
    <div className="flex gap-3">
      <Button variant="outline" onClick={() => setStep(2)} className="flex-1">
        –ù–∞–∑–∞–¥
      </Button>
      <Button 
        onClick={() => setStep(4)}
        disabled={customSchedule.filter(s => s.type === 'principle').length < principlesCount}
        className="flex-1"
      >
        –î–∞–ª—ñ
        <ChevronRight className="ml-2 h-4 w-4" />
      </Button>
    </div>
  </div>
)}
```

### 5. –°–æ–∑–¥–∞—Ç—å API endpoint –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:

```javascript
app.post('/api/user/setup-reminders', authenticateToken, async (req, res) => {
  try {
    const userId = req.user.id;
    const { mode, principlesCount, customSchedule } = req.body;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await db.update(users)
      .set({
        reminderMode: mode,
        dailyPrinciplesCount: principlesCount,
        remindersEnabled: true,
      })
      .where(eq(users.id, userId));
    
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    await db.delete(reminderSchedules).where(eq(reminderSchedules.userId, userId));
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    let scheduleToSave = [];
    
    if (mode === 'custom' && customSchedule) {
      scheduleToSave = customSchedule;
    } else {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
      const presetSchedules = {
        intensive: [
          { time: '07:00', type: 'principle' },
          { time: '11:00', type: 'principle' },
          { time: '15:00', type: 'principle' },
          { time: '19:00', type: 'principle' },
          { time: '21:00', type: 'reflection' },
        ],
        balanced: [
          { time: '08:00', type: 'principle' },
          { time: '13:00', type: 'principle' },
          { time: '18:00', type: 'principle' },
          { time: '21:00', type: 'reflection' },
        ],
        light: [
          { time: '09:00', type: 'principle' },
          { time: '15:00', type: 'principle' },
          { time: '20:00', type: 'reflection' },
        ],
      };
      
      scheduleToSave = presetSchedules[mode] || [];
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    for (const schedule of scheduleToSave) {
      await db.insert(reminderSchedules).values({
        userId,
        time: schedule.time,
        type: schedule.type,
        enabled: schedule.enabled !== false,
      });
    }
    
    res.json({ success: true });
  } catch (error) {
    console.error('Error setting up reminders:', error);
    res.status(500).json({ error: 'Failed to setup reminders' });
  }
});
```

### 6. –û–±–Ω–æ–≤–∏—Ç—å reminder-service.js –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤:

```javascript
// –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é checkAndSendReminders
async function checkAndSendReminders() {
  const now = new Date();
  const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
  
  try {
    // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
    const schedulesToSend = await db
      .select({
        schedule: reminderSchedules,
        user: users,
      })
      .from(reminderSchedules)
      .innerJoin(users, eq(reminderSchedules.userId, users.id))
      .where(
        and(
          eq(reminderSchedules.time, currentTime),
          eq(reminderSchedules.enabled, true),
          eq(users.remindersEnabled, true)
        )
      );
    
    for (const { schedule, user } of schedulesToSend) {
      if (schedule.type === 'principle') {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —É–∂–µ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è
        const today = new Date().toISOString().split('T')[0];
        const todaysPrinciples = await db
          .select()
          .from(userPrinciples)
          .where(
            and(
              eq(userPrinciples.userId, user.id),
              sql`DATE(${userPrinciples.createdAt}) = ${today}`
            )
          );
        
        const principleOrder = todaysPrinciples.length + 1;
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ø—Ä–∏–Ω—Ü–∏–ø —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–æ–º–µ—Ä–∞
        await sendPrincipleReminder(user, principleOrder);
      } else if (schedule.type === 'reflection') {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏
        await sendReflectionReminder(user);
      }
    }
  } catch (error) {
    console.error('Error checking reminders:', error);
  }
}

// –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∞
async function sendPrincipleReminder(user, principleOrder) {
  try {
    const principle = await getRandomPrinciple(user.id);
    if (!principle) return;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏–Ω—Ü–∏–ø —Å –ø–æ—Ä—è–¥–∫–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º
    await db.insert(userPrinciples).values({
      userId: user.id,
      principleId: principle.id,
      principleOrder,
      reminderTime: new Date().toISOString().split('T')[1].substring(0, 5),
      completed: false,
    });
    
    const emoji = principleOrder === 1 ? 'üåÖ' : principleOrder === 2 ? '‚òÄÔ∏è' : principleOrder === 3 ? 'üå§Ô∏è' : 'üåô';
    
    const message = `${emoji} –ü—Ä–∏–Ω—Ü–∏–ø #${principleOrder} –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ\n\n` +
      `<b>"${principle.title}"</b>\n\n` +
      `<i>${principle.description}</i>\n\n` +
      `–¶–µ –≤–∞—à ${principleOrder}-–π –ø—Ä–∏–Ω—Ü–∏–ø –∑ ${user.dailyPrinciplesCount} –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ.\n\n` +
      `üîó <a href="https://your-app-url.replit.app/dashboard">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>`;
    
    await bot.sendMessage(user.telegramId, message, {
      parse_mode: 'HTML',
      disable_web_page_preview: true,
    });
    
    console.log(`Principle #${principleOrder} sent to ${user.firstName}`);
  } catch (error) {
    console.error(`Error sending principle reminder:`, error);
  }
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –ø–æ –≤—Å–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –¥–Ω—è
async function sendReflectionReminder(user) {
  try {
    const today = new Date().toISOString().split('T')[0];
    const todaysPrinciples = await db
      .select({
        principle: principles,
        userPrinciple: userPrinciples,
      })
      .from(userPrinciples)
      .innerJoin(principles, eq(userPrinciples.principleId, principles.id))
      .where(
        and(
          eq(userPrinciples.userId, user.id),
          sql`DATE(${userPrinciples.createdAt}) = ${today}`
        )
      )
      .orderBy(userPrinciples.principleOrder);
    
    if (todaysPrinciples.length === 0) return;
    
    let message = `üåô –ß–∞—Å –ø—ñ–¥–≤–µ—Å—Ç–∏ –ø—ñ–¥—Å—É–º–∫–∏ –¥–Ω—è!\n\n`;
    message += `–°—å–æ–≥–æ–¥–Ω—ñ –≤–∏ –ø—Ä–∞–∫—Ç–∏–∫—É–≤–∞–ª–∏ ${todaysPrinciples.length} –ø—Ä–∏–Ω—Ü–∏–ø–∏:\n\n`;
    
    todaysPrinciples.forEach((item, index) => {
      message += `${index + 1}. "${item.principle.title}"\n`;
    });
    
    message += `\n–û—Ü—ñ–Ω—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø—É:\n`;
    message += `üíö /completed_all - –í–∏–∫–æ–Ω–∞–≤ —É—Å—ñ\n`;
    message += `üíõ /partial_all - –ß–∞—Å—Ç–∫–æ–≤–æ –≤–∏–∫–æ–Ω–∞–≤\n`;
    message += `‚ù§Ô∏è /review_each - –û—Ü—ñ–Ω–∏—Ç–∏ –∫–æ–∂–µ–Ω –æ–∫—Ä–µ–º–æ\n\n`;
    message += `üîó <a href="https://your-app-url.replit.app/analytics">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</a>`;
    
    await bot.sendMessage(user.telegramId, message, {
      parse_mode: 'HTML',
      disable_web_page_preview: true,
    });
    
    console.log(`Reflection reminder sent to ${user.firstName}`);
  } catch (error) {
    console.error(`Error sending reflection reminder:`, error);
  }
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç:

1. **üéØ –ì–æ—Ç–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã:**
   - –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–π (4 –ø—Ä–∏–Ω—Ü–∏–ø–∞)
   - –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (3 –ø—Ä–∏–Ω—Ü–∏–ø–∞) 
   - –õ–µ–≥–∫–∏–π (2 –ø—Ä–∏–Ω—Ü–∏–ø–∞)
   - –ö–∞—Å—Ç–æ–º–Ω—ã–π (2-6 –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤)

2. **‚öôÔ∏è –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
   - –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –º–∏–Ω—É—Ç—ã
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –æ—Ç 2 –¥–æ 6
   - –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

3. **üìä –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞:**
   - –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –≤ –¥–µ–Ω—å
   - –í–µ—á–µ—Ä–Ω—è—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è –ø–æ –≤—Å–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ –∫–∞–∂–¥–æ–º—É

4. **üé® –ö—Ä–∞—Å–∏–≤—ã–π UI:**
   - –ù–∞–≥–ª—è–¥–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∂–∏–º–æ–≤
   - –£–¥–æ–±–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
   - –ü–æ–¥—Å–∫–∞–∑–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏